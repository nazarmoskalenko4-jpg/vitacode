{% extends "base.html" %}
{% block content %}
<h1 class="mb-4">–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–ª–∞–Ω—É —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è</h1>

<form method="post" action="/ui/plan" class="row g-3">
  <div class="col-md-3">
    <label class="form-label">–°—Ç–∞—Ç—å</label>
    <select name="sex" class="form-select" required>
      <option value="male">–ß–æ–ª–æ–≤—ñ—á–∞</option>
      <option value="female">–ñ—ñ–Ω–æ—á–∞</option>
    </select>
  </div>

  <div class="col-md-3">
    <label class="form-label">–í—ñ–∫, —Ä–æ–∫—ñ–≤</label>
    <input type="number" name="age" class="form-control" min="10" max="100" required />
  </div>

  <div class="col-md-3">
    <label class="form-label">–ó—Ä—ñ—Å—Ç, —Å–º</label>
    <input type="number" step="0.1" name="height_cm" class="form-control" required />
  </div>

  <div class="col-md-3">
    <label class="form-label">–í–∞–≥–∞, –∫–≥</label>
    <input type="number" step="0.1" name="weight_kg" class="form-control" required />
  </div>

  <div class="col-md-3">
    <label class="form-label">–ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ</label>
    <select name="activity_factor" class="form-select" required>
      <option value="1.2">1.2 ‚Äî –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å</option>
      <option value="1.375">1.375 ‚Äî –ª–µ–≥–∫–∞ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å</option>
      <option value="1.55" selected>1.55 ‚Äî —Å–µ—Ä–µ–¥–Ω—è –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å</option>
      <option value="1.725">1.725 ‚Äî –≤–∏—Å–æ–∫–∞ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å</option>
      <option value="1.9">1.9 ‚Äî –¥—É–∂–µ –≤–∏—Å–æ–∫–∞ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å</option>
    </select>
  </div>

  <div class="col-md-3">
    <label class="form-label">–¶—ñ–ª—å</label>
    <select name="goal" class="form-select">
      <option value="lose">–°—Ö—É–¥–Ω–µ–Ω–Ω—è</option>
      <option value="maintain" selected>–£—Ç—Ä–∏–º–∞–Ω–Ω—è –≤–∞–≥–∏</option>
      <option value="gain">–ù–∞–±—ñ—Ä –º'—è–∑–æ–≤–æ—ó –º–∞—Å–∏</option>
    </select>
  </div>

  <div class="col-md-3">
    <label class="form-label">–ë—é–¥–∂–µ—Ç –Ω–∞ –¥–µ–Ω—å, –≥—Ä–Ω</label>
    <input type="number" step="1" name="budget_per_day" class="form-control" required />
  </div>

  <div class="col-md-3">
    <label class="form-label">–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –ø–ª–∞–Ω—É</label>
    <select name="mode" class="form-select">
      <option value="day" selected>–ù–∞ 1 –¥–µ–Ω—å</option>
      <option value="week">–ù–∞ —Ç–∏–∂–¥–µ–Ω—å (7 –¥–Ω—ñ–≤)</option>
    </select>
  </div>

  <div class="col-md-12">
    <label class="form-label d-block fw-bold">–ê–ª–µ—Ä–≥—ñ—ó —Ç–∞ –≤–∏–∫–ª—é—á–µ–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç—ñ–≤:</label>
    
    <input type="hidden" name="allergies" id="allergiesInput" value="">

    <div class="card p-3 bg-light">
      <div class="row">
        <div class="col-md-3">
          <div class="form-check">
            <input class="form-check-input allergen-check" type="checkbox" value="gluten" id="alg_gluten">
            <label class="form-check-label" for="alg_gluten">üåæ –ì–ª—é—Ç–µ–Ω</label>
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-check">
            <input class="form-check-input allergen-check" type="checkbox" value="milk" id="alg_milk">
            <label class="form-check-label" for="alg_milk">ü•õ –õ–∞–∫—Ç–æ–∑–∞ / –ú–æ–ª–æ–∫–æ</label>
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-check">
            <input class="form-check-input allergen-check" type="checkbox" value="eggs" id="alg_eggs">
            <label class="form-check-label" for="alg_eggs">ü•ö –Ø–π—Ü—è</label>
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-check">
            <input class="form-check-input allergen-check" type="checkbox" value="fish" id="alg_fish">
            <label class="form-check-label" for="alg_fish">üêü –†–∏–±–∞ / –ú–æ—Ä–µ–ø—Ä–æ–¥—É–∫—Ç–∏</label>
          </div>
        </div>
        <div class="col-md-3 mt-2">
          <div class="form-check">
            <input class="form-check-input allergen-check" type="checkbox" value="nuts" id="alg_nuts">
            <label class="form-check-label" for="alg_nuts">ü•ú –ì–æ—Ä—ñ—Ö–∏</label>
          </div>
        </div>
        <div class="col-md-3 mt-2">
          <div class="form-check">
            <input class="form-check-input allergen-check" type="checkbox" value="soy" id="alg_soy">
            <label class="form-check-label" for="alg_soy">üå± –°–æ—è</label>
          </div>
        </div>
      </div>
    </div>
    <div class="form-text">–û–±–µ—Ä—ñ—Ç—å –ø—Ä–æ–¥—É–∫—Ç–∏, —è–∫—ñ —Å–∏—Å—Ç–µ–º–∞ –º–∞—î –≤–∏–∫–ª—é—á–∏—Ç–∏ –∑ –≤–∞—à–æ–≥–æ —Ä–∞—Ü—ñ–æ–Ω—É.</div>
  </div>

  <div class="col-12 mt-4 text-center">
    <button type="submit" class="btn btn-primary btn-lg px-5">
      –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –ø–ª–∞–Ω
    </button>
    
    <a href="/ui/profiles" class="btn btn-outline-secondary btn-lg ms-3">
      üìÇ –í—Å—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ
    </a>
  </div>
</form>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const checks = document.querySelectorAll('.allergen-check');
    const hiddenInput = document.getElementById('allergiesInput');

    function updateAllergies() {
      const selected = Array.from(checks)
        .filter(c => c.checked)
        .map(c => c.value);
      hiddenInput.value = selected.join(',');
    }

    checks.forEach(c => {
      c.addEventListener('change', updateAllergies);
    });
  });
</script>
{% endblock %}